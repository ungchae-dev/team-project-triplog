<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Í≤åÏãúÍ∏Ä Î™©Î°ù</title>
    
    <!-- Î∏îÎ°úÍ∑∏ ÌéòÏù¥ÏßÄ css Ï†ÑÏ≤¥(6, Ìôà-ÏÉÅÏ†ê-ÌîÑÎ°úÌïÑ-Í≤åÏãúÌåê-Ï£ºÌÅ¨Î∞ïÏä§-Î∞©Î™ÖÎ°ù) ÌôàÏóêÏÑú Î°úÎìú -->
    <link rel="stylesheet" href="/css/home.css" />
    <link rel="stylesheet" href="/css/shop.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/jukebox.css" />
    <link rel="stylesheet" href="/css/guestbook.css" />
    <link rel="stylesheet" href="/css/neighbor.css" />
</head>

<body th:attr="data-nickname=${nickname}">
    <div class="frame">

        <!-- Ïó¨Î∞± ÏïàÏ™ΩÏùò Ïã§Ï†ú Î∏îÎ°úÍ∑∏ Ïª®ÌÖêÏ∏† Ïª®ÌÖåÏù¥ÎÑà -->
        <div class="blog-container">

            <!-- ÏôºÏ™Ω ÌîÑÎ°úÌïÑ ÏÇ¨Ïù¥Îìú (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
            <div id="left-container"></div>

            <!-- Ï§ëÏïô Î©îÏù∏ ÏòÅÏó≠ -->
            <div class="main-area">

                <!-- ÏÉÅÎã® Ìó§Îçî (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
                <div id="top-container"></div>

                <!-- Í≤åÏãúÌåê Ïª®ÌÖêÏ∏† -->
                <div class="main-content">

                    <!-- Í≤åÏãúÌåê Î™©Î°ù -->
                    <div id="board-list">
                        <div class="board-header">
                            <div class="board-left-controls">

                                <a th:href="@{/blog/@{nickname}/post/write(nickname=${nickname})}"><button class="write-btn" th:if="${nickname == loginNickname}"
                                    
                                    type="button">Í∏Ä ÏûëÏÑ±</button>
                                </a>

                            </div>
                            <div class="board-right-controls">
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=updatedAt, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="latest"
                                        th:classappend="${currentSort == 'updatedAt'} ? ' active' : ''">ÏµúÏã†Ïàú</button>
                                </a>
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=likeCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="likes"
                                        th:classappend="${currentSort == 'likeCount'} ? ' active' : ''">Ï¢ãÏïÑÏöîÏàú</button>
                                </a>
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=commentCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="comments"
                                        th:classappend="${currentSort == 'commentCount'} ? ' active' : ''">ÎåìÍ∏ÄÏàú</button>
                                </a>
                                <!-- üî• ÌéòÏù¥ÏßÄ ÏÇ¨Ïù¥Ï¶à ÎìúÎ°≠Îã§Ïö¥ -->
                                <div class="page-size-dropdown">
                                    <button class="board-btn dropdown-btn" th:text="${currentSize + 'Í∞úÏî© ‚ñº'}">5Í∞úÏî©
                                        ‚ñº</button>
                                    <div class="dropdown-menu" style="display: none;">
                                        <div class="dropdown-item" data-size="3"
                                            th:classappend="${currentSize == 3} ? ' active' : ''">3Í∞úÏî©</div>
                                        <div class="dropdown-item" data-size="5"
                                            th:classappend="${currentSize == 5} ? ' active' : ''">5Í∞úÏî©</div>
                                        <div class="dropdown-item" data-size="10"
                                            th:classappend="${currentSize == 10} ? ' active' : ''">10Í∞úÏî©</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <ul th:each="post : ${postList}" class="post-list">
                                <li class="post-item" th:attr="data-post-id=${post.postId}">
                                    <a
                                        th:href="@{/blog/@{nickname}/post/{id}(nickname=${nickname}, id=${post.postId})}">
                                        <img th:if="${post.thumbnail != null}" th:src="${post.thumbnail}" alt="Ïç∏ÎÑ§Ïùº"
                                            class="thumbnail" />
                                        <h3 th:text="${post.title}"></h3>
                                        <div class="meta">
                                            <span th:text="'by ' + ${post.nickname}"></span>
                                            <span th:text="${post.createdAt}"></span>
                                            <span th:text="'‚ù§Ô∏è ' + ${post.likeCount}"></span>
                                            <span th:text="'üí¨ ' + ${post.commentCount}"></span>
                                        </div>
                                    </a>
                                    <div id="detail-tags" style="margin-top: 15px; color: #b865a4;">
                                        <span th:each="hashtag : ${post.hashtags}">
                                            <span th:text="'#' + ${hashtag}">#Ìï¥ÏãúÌÉúÍ∑∏</span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="pagination" th:if="${postList.totalPages > 0}">

                            <a th:if="${!postList.first}"

                                th:href="@{/blog/@{nickname}/post(page=${((((currentPage - 1) / 10) - 1) * 10 + 10) < 1 ? 1 : (((currentPage - 1) / 10) - 1) * 10 + 10}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>Ïù¥Ï†Ñ</button></a>

                            <span
                                th:each="pageNum : ${#numbers.sequence(((currentPage - 1) / 10) * 10 + 1, (((currentPage - 1) / 10) * 10 + 10) > postList.totalPages ? postList.totalPages : ((currentPage - 1) / 10) + 10)}">
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=${pageNum}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}">
                                    <button th:text="${pageNum}"
                                        th:classappend="${postList.number + 1 == pageNum} ? 'active' : ''"></button>
                                </a>
                            </span>


                            <a th:if="${!postList.last}"

                                th:href="@{/blog/@{nickname}/post(page=${((((currentPage - 1) / 10) + 1) * 10 + 1) > postList.totalPages ? postList.totalPages : (((currentPage - 1) / 10) + 1) * 10 + 1}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>Îã§Ïùå</button></a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Ïò§Î•∏Ï™Ω ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
            <div id="right-container"></div>
        </div>
    </div>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            const url = new URL(window.location.href);
            const params = url.searchParams;

            // ÌòÑÏû¨ URLÏù¥ /postÎ°ú ÎÅùÎÇòÍ≥†, ÏøºÎ¶¨ ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î¶¨Îã§Ïù¥Î†âÌä∏
            const pathname = url.pathname;
            const isPostPage = pathname.endsWith('/post') || pathname.match(/\/post\/?$/);
            const hasParams = params.has('page') || params.has('size') || params.has('sort') || params.has('dir');

            if (isPostPage && !hasParams) {
                const nickname = document.body.getAttribute('data-nickname');
                const redirectUrl = new URL(`${window.location.origin}/blog/${nickname}/post`);
                redirectUrl.searchParams.set('page', '1');
                redirectUrl.searchParams.set('size', '5');
                redirectUrl.searchParams.set('sort', 'updatedAt');
                redirectUrl.searchParams.set('dir', 'desc');
                window.location.replace(redirectUrl.toString());
            }
        });
    
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌòÑÏû¨ sort Í∞íÏóê ÎßûÏ∂∞ active ÌÅ¥ÎûòÏä§ ÌÜ†Í∏Ä
        window.addEventListener('DOMContentLoaded', () => {
            const sortMap = {
                latest: 'updatedAt',
                likes: 'likeCount',
                comments: 'commentCount'
            };

            // ÌòÑÏû¨ ÏÇ¨Ïù¥Ï¶à ÌëúÏãú
            const pageSizeBtn = document.querySelector('.page-size-dropdown .dropdown-btn');
            const currentSize = new URL(window.location.href).searchParams.get('size') || '5';
            pageSizeBtn.textContent = `${currentSize}Í∞úÏî© ‚ñº`;

            document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-size') === currentSize);
            });


            // üî• ÌéòÏù¥ÏßÄ ÏÇ¨Ïù¥Ï¶à ÎìúÎ°≠Îã§Ïö¥ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä

            const dropdownBtn = document.querySelector('.dropdown-btn');
            const dropdownMenu = document.querySelector('.dropdown-menu');

            // ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
            dropdownBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
            });

            // ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            const menuItems = dropdownMenu.querySelectorAll('.dropdown-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    const newSize = parseInt(this.getAttribute('data-size'));
                    changePageSize(newSize);
                    dropdownMenu.style.display = 'none';

                    // active ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            document.addEventListener('click', function () {
                dropdownMenu.style.display = 'none';
            });


            // ÎìúÎ°≠Îã§Ïö¥ ÌÅ¥Î¶≠ Ïãú ÌéòÏù¥ÏßÄ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω
            document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', () => {
                    const size = item.getAttribute('data-size');
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('size', size);
                    currentUrl.searchParams.set('page', 1);
                    window.location.href = currentUrl.toString();
                });
            });

        });
    </script>


    <!-- Î†àÏù¥ÏïÑÏõÉ + Î∏îÎ°úÍ∑∏ ÌéòÏù¥ÏßÄ js Ï†ÑÏ≤¥(7, Ìôà-ÏÉÅÏ†ê-ÌîÑÎ°úÌïÑ-Í≤åÏãúÌåê-Ï£ºÌÅ¨Î∞ïÏä§-Î∞©Î™ÖÎ°ù) ÌôàÏóêÏÑú Î°úÎìú -->
    <script src="/js/layout.js"></script>
    <script src="/js/home.js"></script>
    <script src="/js/shop.js"></script>
    <script src="/js/profile.js"></script>
    <script src="/js/jukebox.js"></script>
    <script src="/js/guestbook.js"></script>
    <script src="/js/post.js"></script>
    <script src="/js/neighbor.js"></script>

</body>

</html>