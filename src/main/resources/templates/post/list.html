<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Í≤åÏãúÍ∏Ä Î™©Î°ù</title>
    <!-- Î∏îÎ°úÍ∑∏ ÌéòÏù¥ÏßÄ css Ï†ÑÏ≤¥(7, Ìôà-ÏÉÅÏ†ê-ÌîÑÎ°úÌïÑ-Í≤åÏãúÌåê-Ï£ºÌÅ¨Î∞ïÏä§-ÎßàÏù¥Î°úÍ∑∏-Î∞©Î™ÖÎ°ù) ÌôàÏóêÏÑú Î°úÎìú -->
    <link rel="stylesheet" href="/css/home.css" />
    <link rel="stylesheet" href="/css/shop.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/jukebox.css" />
    <link rel="stylesheet" href="/css/mylog.css" />
    <link rel="stylesheet" href="/css/guestbook.css" />
</head>
<body>
    <div class="frame">

        <!-- Ïó¨Î∞± ÏïàÏ™ΩÏùò Ïã§Ï†ú Î∏îÎ°úÍ∑∏ Ïª®ÌÖêÏ∏† Ïª®ÌÖåÏù¥ÎÑà -->
        <div class="blog-container">

            <!-- ÏôºÏ™Ω ÌîÑÎ°úÌïÑ ÏÇ¨Ïù¥Îìú (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
            <div id="left-container"></div>

            <!-- Ï§ëÏïô Î©îÏù∏ ÏòÅÏó≠ -->
            <div class="main-area">

                <!-- ÏÉÅÎã® Ìó§Îçî (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
                <div id="top-container"></div>

                <!-- Í≤åÏãúÌåê Ïª®ÌÖêÏ∏† -->
                <div class="main-content">

                    <!-- Í≤åÏãúÌåê Î™©Î°ù -->
                    <div id="board-list">
                        <div class="board-header">
                            <div class="board-left-controls">
                                <button class="write-btn" th:if="${nickname == loginNickname}"
                                        th:onclick="|location.href='@{/blog/@{nickname}/post/write(nickname=${nickname})}'|" type="button">Í∏Ä ÏûëÏÑ±</button>
                            </div>
                            <div class="board-right-controls">
                                <!-- üî• ÌéòÏù¥ÏßÄ ÏÇ¨Ïù¥Ï¶à ÎìúÎ°≠Îã§Ïö¥ -->
                                <div class="page-size-dropdown">
                                    <button class="board-btn dropdown-btn">5Í∞úÏî© ‚ñº</button>
                                    <div class="dropdown-menu">
                                        <div class="dropdown-item" data-size="3">3Í∞úÏî©</div>
                                        <div class="dropdown-item" data-size="5">5Í∞úÏî©</div>
                                        <div class="dropdown-item" data-size="10">10Í∞úÏî©</div>
                                    </div>
                                </div>
                                <a th:href="@{/blog/@{nickname}/post(page=1, sort=updatedAt, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn active" data-sort="latest">ÏµúÏã†Ïàú</button>
                                </a>
                                <a th:href="@{/blog/@{nickname}/post(page=1, sort=likeCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="likes">Ï¢ãÏïÑÏöîÏàú</button>
                                </a>
                                <a th:href="@{/blog/@{nickname}/post(page=1, sort=commentCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="comments">ÎåìÍ∏ÄÏàú</button>
                                </a>
                            </div>
                        </div>
                        <div>
                            <ul th:each="post : ${postList}" class="post-list">
                                <li class="post-item" th:attr="data-post-id=${post.postId}">
                                    <a th:href="@{/blog/@{nickname}/post/{id}(nickname=${nickname}, id=${post.postId})}">
                                        <img th:if="${post.thumbnail != null}" th:src="${post.thumbnail}" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail"/>
                                        <h3 th:text="${post.title}"></h3>                
                                        <div class="meta">
                                            <span th:text="'by ' + ${post.nickname}"></span>
                                            <span th:text="${post.createdAt}"></span>
                                            <span th:text="'‚ù§Ô∏è ' + ${post.likeCount}"></span>
                                            <span th:text="'üí¨ ' + ${post.commentCount}"></span>
                                        </div>
                                    </a>
                                    <div id="detail-tags" style="margin-top: 15px; color: #b865a4;">
                                        <span th:each="hashtag : ${post.hashtags}">
                                            <span th:text="'#' + ${hashtag}">#Ìï¥ÏãúÌÉúÍ∑∏</span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="pagination" th:if="${postList.totalPages > 0}">
                            <a th:if="${!postList.first}"
                                    th:href="@{/blog/@{nickname}/post(page=1, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>&laquo;</button></a>
                            <a th:if="${!postList.first}"
                                    th:href="@{/blog/@{nickname}/post(page=${postList.number}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>Ïù¥Ï†Ñ</button></a>

                            <span th:each="pageNum : ${#numbers.sequence(1, postList.totalPages)}">
                                <a th:href="@{/blog/@{nickname}/post(page=${pageNum}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}">
                                    <button th:text="${pageNum}" th:classappend="${postList.number + 1 == pageNum} ? 'active' : ''"></button>
                                </a>
                            </span>

                            <a th:if="${!postList.last}"
                                    th:href="@{/blog/@{nickname}/post(page=${postList.number + 2}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>Îã§Ïùå</button></a>

                            <a th:if="${!postList.last}"
                                    th:href="@{/blog/@{nickname}/post(page=${postList.totalPages}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>&raquo;</button></a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Ïò§Î•∏Ï™Ω ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (Ïª¥Ìè¨ÎÑåÌä∏Î°ú Î°úÎìú) -->
            <div id="right-container"></div>
        </div>
    </div>

</body>
<script>
    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌòÑÏû¨ sort Í∞íÏóê ÎßûÏ∂∞ active ÌÅ¥ÎûòÏä§ ÌÜ†Í∏Ä
    window.addEventListener('DOMContentLoaded', () => {
        const sortMap = {
            latest: 'updatedAt',
            likes: 'likeCount',
            comments: 'commentCount'
        };

        // ÎìúÎ°≠Îã§Ïö¥ ÌÅ¥Î¶≠ Ïãú ÌéòÏù¥ÏßÄ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω
        document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                const size = item.getAttribute('data-size');
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('size', size);
                currentUrl.searchParams.set('page', 1);
                window.location.href = currentUrl.toString();
            });
        });

        /*
        // Ï†ïÎ†¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Ï†ïÎ†¨ Î≥ÄÍ≤Ω
        const sortButtons = document.querySelectorAll('.board-btn[data-sort]');
        sortButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const sort = btn.getAttribute('data-sort');
                const actualSort = sortMap[sort] || 'updatedAt';
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('sort', actualSort);
                currentUrl.searchParams.set('page', 1);
                window.location.href = currentUrl.toString();
            });
        });
        */
/*
        // Ï†ïÎ†¨ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
        let sortBtns = document.querySelectorAll('.board-right-controls .board-btn');
        sortBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Í∏∞Ï°¥ active Ï†úÍ±∞
                sortBtns.forEach(b => b.classList.remove('active'));
                // ÌÅ¥Î¶≠Îêú Î≤ÑÌäºÏóê active Ï∂îÍ∞Ä
                this.classList.add('active');
                
                // Ï†ïÎ†¨ Î∞©Ïãù Ï†ÅÏö©
                const sortType = this.textContent.includes('ÏµúÏã†Ïàú') ? 'latest' : 
                            this.textContent.includes('Ï¢ãÏïÑÏöîÏàú') ? 'likes' : 'comments';
                changeSortType(sortType);
            
                console.log('Ï†ïÎ†¨ Î∞©Ïãù Î≥ÄÍ≤Ω:', this.textContent);
            });
        });
*/
        // ÌòÑÏû¨ Ï†ïÎ†¨ ÏÉÅÌÉúÏóê Îî∞Îùº active ÌÅ¥ÎûòÏä§ Ï†ÅÏö©
        const currentSortParam = new URL(window.location.href).searchParams.get('sort') || 'updatedAt';
        sortButtons.forEach(btn => {
            const mappedSort = sortMap[btn.getAttribute('data-sort')];
            btn.classList.toggle('active', mappedSort === currentSortParam);
        });

        // ÌòÑÏû¨ ÏÇ¨Ïù¥Ï¶à ÌëúÏãú
        const pageSizeBtn = document.querySelector('.page-size-dropdown .dropdown-btn');
        const currentSize = new URL(window.location.href).searchParams.get('size') || '5';
        pageSizeBtn.textContent = `${currentSize}Í∞úÏî© ‚ñº`;

        document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
            item.classList.toggle('active', item.getAttribute('data-size') === currentSize);
        });
    });

    // üî• ÌéòÏù¥ÏßÄ ÏÇ¨Ïù¥Ï¶à ÎìúÎ°≠Îã§Ïö¥ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
    const pageSizeDropdown = document.querySelector('.page-size-dropdown');
    if (pageSizeDropdown) {
        const dropdownBtn = pageSizeDropdown.querySelector('.dropdown-btn');
        const dropdownMenu = pageSizeDropdown.querySelector('.dropdown-menu');
        
        // ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
        dropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
        });
        
        // ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        const menuItems = dropdownMenu.querySelectorAll('.dropdown-item');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const newSize = parseInt(this.getAttribute('data-size'));
                changePageSize(newSize);
                dropdownMenu.style.display = 'none';
                
                // active ÏÉÅÌÉú Î≥ÄÍ≤Ω
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
        document.addEventListener('click', function() {
            dropdownMenu.style.display = 'none';
        });
    }

    function changeSortType(sortKey) {
        const sortMap = {
            latest: 'updatedAt',
            likes: 'likeCount',
            comments: 'commentCount'
        };

        const actualSort = sortMap[sortKey] || 'updatedAt';
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('sort', actualSort);
        currentUrl.searchParams.set('page', 1); // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
        window.location.href = currentUrl.toString();
    }

    
</script>
<script src="/js/layout.js"></script>
<script src="/js/home.js"></script>
<script src="/js/shop.js"></script>
<script src="/js/profile.js"></script>

<script src="/js/jukebox.js"></script>
<script src="/js/mylog.js"></script>
<script src="/js/guestbook.js"></script>
</html>
