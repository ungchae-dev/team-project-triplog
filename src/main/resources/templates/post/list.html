<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ëª©ë¡</title>
    
    <!-- ë¸”ë¡œê·¸ í˜ì´ì§€ css ì „ì²´(6, í™ˆ-ìƒì -í”„ë¡œí•„-ê²Œì‹œíŒ-ì£¼í¬ë°•ìŠ¤-ë°©ëª…ë¡) í™ˆì—ì„œ ë¡œë“œ -->
    <link rel="stylesheet" href="/css/home.css" />
    <link rel="stylesheet" href="/css/shop.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <link rel="stylesheet" href="/css/post.css" />
    <link rel="stylesheet" href="/css/jukebox.css" />
    <link rel="stylesheet" href="/css/guestbook.css" />
    <link rel="stylesheet" href="/css/neighbor.css" />
</head>

<body th:attr="data-nickname=${nickname}">
    <div class="frame">

        <!-- ì—¬ë°± ì•ˆìª½ì˜ ì‹¤ì œ ë¸”ë¡œê·¸ ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ -->
        <div class="blog-container">

            <!-- ì™¼ìª½ í”„ë¡œí•„ ì‚¬ì´ë“œ (ì»´í¬ë„ŒíŠ¸ë¡œ ë¡œë“œ) -->
            <div id="left-container"></div>

            <!-- ì¤‘ì•™ ë©”ì¸ ì˜ì—­ -->
            <div class="main-area">

                <!-- ìƒë‹¨ í—¤ë” (ì»´í¬ë„ŒíŠ¸ë¡œ ë¡œë“œ) -->
                <div id="top-container"></div>

                <!-- ê²Œì‹œíŒ ì»¨í…ì¸  -->
                <div class="main-content">

                    <!-- ê²Œì‹œíŒ ëª©ë¡ -->
                    <div id="board-list">
                        <div class="board-header">
                            <div class="board-left-controls">

                                <a th:href="@{/blog/@{nickname}/post/write(nickname=${nickname})}"><button class="write-btn" th:if="${nickname == loginNickname}"
                                    
                                    type="button">ê¸€ ì‘ì„±</button>
                                </a>

                            </div>
                            <div class="board-right-controls">
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=updatedAt, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="latest"
                                        th:classappend="${currentSort == 'updatedAt'} ? ' active' : ''">ìµœì‹ ìˆœ</button>
                                </a>
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=likeCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="likes"
                                        th:classappend="${currentSort == 'likeCount'} ? ' active' : ''">ì¢‹ì•„ìš”ìˆœ</button>
                                </a>
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=1, size=${currentSize}, sort=commentCount, dir=${currentDir}, nickname=${nickname})}">
                                    <button class="board-btn" data-sort="comments"
                                        th:classappend="${currentSort == 'commentCount'} ? ' active' : ''">ëŒ“ê¸€ìˆœ</button>
                                </a>
                                <!-- ğŸ”¥ í˜ì´ì§€ ì‚¬ì´ì¦ˆ ë“œë¡­ë‹¤ìš´ -->
                                <div class="page-size-dropdown">
                                    <button class="board-btn dropdown-btn" th:text="${currentSize + 'ê°œì”© â–¼'}">5ê°œì”©
                                        â–¼</button>
                                    <div class="dropdown-menu" style="display: none;">
                                        <div class="dropdown-item" data-size="3"
                                            th:classappend="${currentSize == 3} ? ' active' : ''">3ê°œì”©</div>
                                        <div class="dropdown-item" data-size="5"
                                            th:classappend="${currentSize == 5} ? ' active' : ''">5ê°œì”©</div>
                                        <div class="dropdown-item" data-size="10"
                                            th:classappend="${currentSize == 10} ? ' active' : ''">10ê°œì”©</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <ul th:each="post : ${postList}" class="post-list">
                                <li class="post-item" th:attr="data-post-id=${post.postId}">
                                    <a
                                        th:href="@{/blog/@{nickname}/post/{id}(nickname=${nickname}, id=${post.postId})}">
                                        <img th:if="${post.thumbnail != null}" th:src="${post.thumbnail}" alt="ì¸ë„¤ì¼"
                                            class="thumbnail" />
                                        <h3 th:text="${post.title}"></h3>
                                        <div class="meta">
                                            <span th:text="'by ' + ${post.nickname}"></span>
                                            <span th:text="${post.createdAt}"></span>
                                            <span th:text="'â¤ï¸ ' + ${post.likeCount}"></span>
                                            <span th:text="'ğŸ’¬ ' + ${post.commentCount}"></span>
                                        </div>
                                    </a>
                                    <div id="detail-tags" style="margin-top: 15px; color: #b865a4;">
                                        <span th:each="hashtag : ${post.hashtags}">
                                            <span th:text="'#' + ${hashtag}">#í•´ì‹œíƒœê·¸</span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="pagination" th:if="${postList.totalPages > 0}">

                            <a th:if="${!postList.first}"

                                th:href="@{/blog/@{nickname}/post(page=${((((currentPage - 1) / 10) - 1) * 10 + 10) < 1 ? 1 : (((currentPage - 1) / 10) - 1) * 10 + 10}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>ì´ì „</button></a>

                            <span
                                th:each="pageNum : ${#numbers.sequence(((currentPage - 1) / 10) * 10 + 1, (((currentPage - 1) / 10) * 10 + 10) > postList.totalPages ? postList.totalPages : ((currentPage - 1) / 10) + 10)}">
                                <a
                                    th:href="@{/blog/@{nickname}/post(page=${pageNum}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}">
                                    <button th:text="${pageNum}"
                                        th:classappend="${postList.number + 1 == pageNum} ? 'active' : ''"></button>
                                </a>
                            </span>


                            <a th:if="${!postList.last}"

                                th:href="@{/blog/@{nickname}/post(page=${((((currentPage - 1) / 10) + 1) * 10 + 1) > postList.totalPages ? postList.totalPages : (((currentPage - 1) / 10) + 1) * 10 + 1}, size=${currentSize}, sort=${currentSort}, dir=${currentDir}, nickname=${nickname})}"><button>ë‹¤ìŒ</button></a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ì˜¤ë¥¸ìª½ ë„¤ë¹„ê²Œì´ì…˜ (ì»´í¬ë„ŒíŠ¸ë¡œ ë¡œë“œ) -->
            <div id="right-container"></div>
        </div>
    </div>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            const url = new URL(window.location.href);
            const params = url.searchParams;

            // í˜„ì¬ URLì´ /postë¡œ ëë‚˜ê³ , ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸
            const pathname = url.pathname;
            const isPostPage = pathname.endsWith('/post') || pathname.match(/\/post\/?$/);
            const hasParams = params.has('page') || params.has('size') || params.has('sort') || params.has('dir');

            if (isPostPage && !hasParams) {
                const nickname = document.body.getAttribute('data-nickname');
                const redirectUrl = new URL(`${window.location.origin}/blog/${nickname}/post`);
                redirectUrl.searchParams.set('page', '1');
                redirectUrl.searchParams.set('size', '5');
                redirectUrl.searchParams.set('sort', 'updatedAt');
                redirectUrl.searchParams.set('dir', 'desc');
                window.location.replace(redirectUrl.toString());
            }
        });
    </script>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ sort ê°’ì— ë§ì¶° active í´ë˜ìŠ¤ í† ê¸€
        window.addEventListener('DOMContentLoaded', () => {
            const sortMap = {
                latest: 'updatedAt',
                likes: 'likeCount',
                comments: 'commentCount'
            };

            // í˜„ì¬ ì‚¬ì´ì¦ˆ í‘œì‹œ
            const pageSizeBtn = document.querySelector('.page-size-dropdown .dropdown-btn');
            const currentSize = new URL(window.location.href).searchParams.get('size') || '5';
            pageSizeBtn.textContent = `${currentSize}ê°œì”© â–¼`;

            document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-size') === currentSize);
            });


            // ğŸ”¥ í˜ì´ì§€ ì‚¬ì´ì¦ˆ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ ì¶”ê°€

            const dropdownBtn = document.querySelector('.dropdown-btn');
            const dropdownMenu = document.querySelector('.dropdown-menu');

            // ë“œë¡­ë‹¤ìš´ í† ê¸€
            dropdownBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
            });

            // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
            const menuItems = dropdownMenu.querySelectorAll('.dropdown-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    const newSize = parseInt(this.getAttribute('data-size'));
                    changePageSize(newSize);
                    dropdownMenu.style.display = 'none';

                    // active ìƒíƒœ ë³€ê²½
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function () {
                dropdownMenu.style.display = 'none';
            });


            // ë“œë¡­ë‹¤ìš´ í´ë¦­ ì‹œ í˜ì´ì§€ í¬ê¸° ë³€ê²½
            document.querySelectorAll('.page-size-dropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', () => {
                    const size = item.getAttribute('data-size');
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('size', size);
                    currentUrl.searchParams.set('page', 1);
                    window.location.href = currentUrl.toString();
                });
            });

        });
    </script>


    <!-- ë ˆì´ì•„ì›ƒ + ë¸”ë¡œê·¸ í˜ì´ì§€ js ì „ì²´(7, í™ˆ-ìƒì -í”„ë¡œí•„-ê²Œì‹œíŒ-ì£¼í¬ë°•ìŠ¤-ë°©ëª…ë¡) í™ˆì—ì„œ ë¡œë“œ -->
    <script src="/js/layout.js"></script>
    <script src="/js/home.js"></script>
    <script src="/js/shop.js"></script>
    <script src="/js/profile.js"></script>
    <script src="/js/jukebox.js"></script>
    <script src="/js/guestbook.js"></script>
    <script src="/js/post.js"></script>
    <script src="/js/neighbor.js"></script>

</body>

</html>