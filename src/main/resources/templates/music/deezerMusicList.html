<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì¥ë¥´ë³„ ìŒì•…</title>
     <script>
        async function purchaseMusic(title, artist, album, previewUrl) {
            // ë„í† ë¦¬ êµ¬ë§¤ë¥¼ ìœ„í•œ API í˜¸ì¶œ
                const response = await fetch("/api/music/purchase", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        title: title,
                        artist: artist,
                        album: album,
                        previewUrl: previewUrl
                    })
                });

                if (!response.ok) {
                 const errorText = await response.text(); // JSONì´ ì•„ë‹ ìˆ˜ë„ ìˆìœ¼ë‹ˆ textë¡œ ë°›ìŒ
                 alert("êµ¬ë§¤ ì‹¤íŒ¨: " + errorText);
                 return;
            }

                 const result = await response.json();
                 alert(result.message + "\në‚¨ì€ ë„í† ë¦¬: " + result.remainingAcorn);
    }
    </script>
</head>
<body>
<h1>ğŸµ ì¥ë¥´ë³„ ì¸ê¸° ìŒì•…</h1>

<form method="get" action="/music/deezer">
    <label for="genre">ì¥ë¥´ ì„ íƒ: </label>
    <select name="genreId" id="genre">
        <option value="132">Pop</option>
        <option value="16">Asia</option>
        <option value="106">Electro</option>
        <option value="152">Rock</option>
        <option value="464">Metal</option>
        <option value="116">Rap/Hip-Hop</option>
        <option value="129">Jazz</option>
        <option value="153">Blues</option>
    </select>
    <button type="submit">ì¡°íšŒ</button>
</form>

<div th:if="${musicList != null}">
    <h2 th:text="'ğŸ¶ ' + ${genreName} + ' ìŒì•… ëª©ë¡'">ğŸ¶ ìŒì•… ëª©ë¡</h2>
    <ul>
    <li th:each="track : ${musicList}">
        <p>
            <strong th:text="${track.title}"></strong> -
            <span th:text="${track.artist}"></span>
        </p>

        <!-- ğŸ” musicIdê°€ ì˜ ì£¼ì…ë˜ì—ˆëŠ”ì§€ í™•ì¸ìš© -->
        <p style="color:blue">musicId: <span th:text="${track.musicId}"></span></p>
        <img th:src="${track.album}" width="150"/>

        <!-- âœ… êµ¬ë§¤í•œ ê²½ìš° -->
       <div th:if="${#lists.contains(purchasedMusicIds, track.musicId)}">
            <audio controls th:src="${track.musicFile}"></audio>
            <button disabled>ì´ë¯¸ êµ¬ë§¤í•¨</button>
        </div>

        <!-- âŒ ë¯¸êµ¬ë§¤í•œ ê²½ìš° -->
        <div th:unless="${#lists.contains(purchasedMusicIds, track.musicId)}">
            <p style="color: gray;">ë¯¸êµ¬ë§¤ - ë„í† ë¦¬ 10ê°œ í•„ìš”</p>
            <button
                th:attr="onclick=|purchaseMusic('${track.title}', '${track.artist}', '${track.album}', '${track.musicFile}')|">
                ë„í† ë¦¬ 10ê°œë¡œ êµ¬ë§¤
            </button>
        </div>
    </li>
</ul>

     <div style="margin-top: 20px;">
        <a th:if="${currentPage > 0}"
           th:href="@{/music/deezer(genreId=${genreId}, page=${currentPage - 1})}">â¬… ì´ì „</a>

        <span style="margin: 0 10px;">í˜„ì¬ í˜ì´ì§€: <b th:text="${currentPage + 1}">1</b></span>

        <a th:if="${musicList.size() == 5}"
           th:href="@{/music/deezer(genreId=${genreId}, page=${currentPage + 1})}">ë‹¤ìŒ â¡</a>
    </div>
</div>
</body>
</html>
